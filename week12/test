#!/bin/bash

# URL of the webpage
URL="http://10.0.17.6/Assignment.html"

# Fetch the webpage HTML and save it to a temporary file
curl -s "$URL" -o page.html

# Use xmllint to format the HTML so it is more manageable
xmllint --html --format page.html -o formatted_page.html 2>/dev/null

# Extract rows from each table and combine them
table_rows=$(awk '/<table/,/<\/table>/ {if ($0 ~ /<tr>/) print}' formatted_page.html)

# Use grep to get all table row contents and parse out pressure, temperature, and datetime
echo "Pressure, Temperature, DateTime"

# Process each row to extract the columns in the desired format
echo "$table_rows" | while IFS= read -r row; do
    # Extract pressure, temperature, and datetime using grep and sed
    pressure=$(echo "$row" | grep -oP '(?<=<td>)[^<]+' | sed -n '1p')
    temperature=$(echo "$row" | grep -oP '(?<=<td>)[^<]+' | sed -n '2p')
    datetime=$(echo "$row" | grep -oP '(?<=<td>)[^<]+' | sed -n '3p')
    
    # Print in the desired format
    echo "$pressure, $temperature, $datetime"
done

# Clean up
rm page.html formatted_page.html
